<html lang="en">
<head>
	<style>
		body {
		  margin: 0;
		  padding: 0;
		  font-family: verdana, sans-serif;
		  font-size: 69%;
		  color: #000;
		  background-color: #fff;
		}
		.light {background-color:#eedd99;}
		.hard {background-color:#eeeded;}
		.selectHdr {
			border-bottom: 4px orange solid
			; background-color:#228833
		}
		.selectTd {
			  border-left : 2px blue solid
			; border-right: 2px blue solid
			; background-image: url(/i/r.png)
		}
		select {background-color: white;}
		
		input {
			padding:2px;
			margin:0px;
		}
		i {
			color:blue;
			font-size:13px;
		}

	</style>
	<!--
		http://www.w3.org/TR/css3-selectors/#attribute-substrings
	-->
</head>

<body>
	<div style="height:200px;">
		<p>Hosts:</p>
		<div style="width:600px;">
			<i style="width:100px;float:left;">location</i>
			<i >hostname</i>
			<br>
			<u id="loc_drpdwn">
			</u>
				<input id="new_hostname" style="width:300px;" value="portal.odobo.com"> 
				<input type="button" onclick="add_hostname();" value="add">
			<br>
			<br>
			<div id="sql_state" style="background-color:brown;color:white;width:100%;">
			</div>
			<u onclick="hostsList(this.parentElement.children[10],1); ">change</u>	
			<i></i>		
			<div id="changeHost">
			</div>
		
		</div>
	</div>
	
	
	
	
	
	<hr>
	New Pairs:
	<br>
	<br>
	
	<div id="env_drpdwn" onchange="formateNewService(this);">
	</div>
	
	<br>
	
	<br>
	<div>
		<u onclick="hostsList(this.parentElement.children[3],2);">change</u>
		<i></i>	
	
		<table style="white-space:nowrap;width:600px;display:none;" id="hostsTable" >
			<tr>
			<td>
				<i>Rackspace:</i>
				<br>
				<u id="hosts_drpdwnRs" onchange="formateNewService(this);"></u>
			</td>
			<td>
				<i>Amazon:</i>
				<br>
				<u id="hosts_drpdwnAws" onchange="formateNewService(this);"></u>
			</td>
			<td>
				<i>Continent 8:</i>
				<br>
				<u id="hosts_drpdwnC8" onchange="formateNewService(this);"></u>
			</td>
			<td>
				<i>Others: </i>
				<br>
				<u id="hosts_drpdwnOthers" onchange="formateNewService(this);"></u>
			</td>
			<td>
				<i>Obsolete: </i>
				<br>
				<u id="hosts_drpdwnFalse" onchange="formateNewService(this);"></u>
			</td>
		</tr>
		</table>
		<br>
	
		<div id="serviceTypes" onchange="formateNewService(this);">
		</div>
	
		<br>

		<div id="serviceAdd">
		</div>
	</div>
	
</body>


<script src="ajax.js"></script>
<script src="central.js"></script>

<script>

function add_hostname() {
	var v = document.getElementById('new_hostname').value;
	var loc = document.getElementById('loc_drpdwn').children[0].value;
	
	loadJSON(
		window.location.origin + '/c?q=insertHostname&hostname='+encodeURIComponent(v)+'&loc_drpdwn='+loc
		, function (d,a) {
			var d = JSON.parse(d);
			
			var s = document.getElementById('sql_state');
			if (document.getElementById('new_hostname').value.length < 5 ) {
				s.style.border = '2px orange solid';
				s.style.backgroundColor = 'red';
				s.style.color = 'orange';
				s.innerHTML='value too short to be hostname';
				return false;
			}
			if (d.rows[0] && d.rows[0].str && d.rows[0].str.substr(0,5) == 'ERROR') {
				d.detail = d.rows[0].str;
				//console.log(d.rows[0].str.substr(0,5));
			}
			if (d.detail) {
				s.style.border = '2px orange solid';
				s.style.backgroundColor = 'brown';
				s.style.color = 'orange';
				s.innerHTML=d.detail;
			}
			if (!d.detail && d.rowCount) {
				s.style.border = '2px purple solid';
				s.style.backgroundColor = 'green';
				s.style.color = 'blue';
				s.innerHTML=d.rows[0].ts+': '+d.rows[0].str;
				//console.log(d);
			}
		}	
		, function () {
			console.log('err');
		}	
		, {}
	);
	
}

function getHostProp(hn) {
	loadJSON(
		window.location.origin + '/c?q=hostNames'
		, function (d,a) {
			var d = JSON.parse(d);
			for (var i=0;i<d.rowCount;i++) {
				if (d.rows[i].hostname == hn) {
					var l = document.getElementById('loc_drpdwn');
					l.getElementsByTagName('option')[d.rows[i].cloud-1].selected = 'selected';
					document.getElementById('changeHost').innerHTML=hn
						+ ' valid: '
						+ d.rows[i].valid
						+ ' location: '
						+ d.rows[i].cloud
						+ l.innerHTML
					;
					console.log(d.rows[i]);
				}
			}

		}	
		, function () {
			console.log('err');
		}	
		, {}
	);

}

function formateNewService(t) {
	var host = document.getElementById('hosts_drpdwnOthers').children[0];
	if (t.id.substr(0,12) == 'hosts_drpdwn' ) {
		var host = document.getElementById(t.id).children[0];
	}
	var env = document.getElementById('env_drpdwn').children[0];
	var type = document.getElementById('serviceTypes').children[0];
	var o = document.getElementById('serviceAdd');
	if (v.wa.n == 2) {
		o.innerHTML='create:: '
			+env[env.selectedIndex].text+'  '+ host[host.selectedIndex].text+' '+type[type.selectedIndex].text+' '
			+ '<BR>send: ' 
			+env.value+' '+ host.value+' '+type.value+' '
		;
	}
	if (v.wa.n == 1) {
		getHostProp(host[host.selectedIndex].text);
	}
}

function hostsList(here,n) {
	v.wa.n=n;
	var o = document.getElementById('hostsTable'); 
	var h = o.innerHTML; 
	o.parentElement.removeChild(o); 
	var t = document.createElement('TABLE');
	t.id = 'hostsTable';
	t.innerHTML = h;
	t.style.display = '';
	here.appendChild(t);	
}

</script>




























































</html>

